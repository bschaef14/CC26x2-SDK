<!-- HTML header for doxygen 1.8.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.12"/>
<title>TI-OpenThread: Network Co-Processor Example Application</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link id="favicon" rel="shortcut icon" type="image/x-icon" href="favicon.ico"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="tiapistylesheet.css" rel="stylesheet" type="text/css" />
</head>
<body>
<table width="100%">
<tr>
  <td bgcolor="black" width="1"><a href="http://www.ti.com"><img border="0" src="tilogo.gif" /></a></td>
  <td bgcolor="red"><img src="titagline.gif" /></td>
</tr>
</table>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">TI-OpenThread
   &#160;<span id="projectnumber">1.08.01.12</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.12 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Network Co-Processor Example Application </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>Table of Contents</h2>
<ul>
<li><a href="#sysconfig-notice">SysConfig Notice</a></li>
<li><a href="#intro">Introduction</a></li>
<li><a href="#hardware-prereqs">Hardware Prerequisites</a></li>
<li><a href="#software-prereqs">Software Prerequisites</a></li>
<li><a href="#functional-desc">Functional Description</a><ul>
<li><a href="#software-overview">Software Overview</a><ul>
<li><a href="#application">Application Files</a></li>
<li><a href="#example-application">Example Application</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sysconfig">Configuration With SysConfig</a></li>
<li><a href="#usage">Usage</a><ul>
<li><a href="#usage-buttons">Buttons</a></li>
<li><a href="#usage-display">Display</a></li>
<li><a href="#usage-setup-nwk">Setting up the Thread Network</a></li>
<li><a href="#usage-control">Interfacing with the Example Application</a></li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="intro"></a> Introduction</h1>
<p>This document discusses how to use the Network Co-Processor example application.</p>
<p>The NCP example is intended to be used with a host processor connected through UART or SPI. This example is setup to connect with the UART interface over the XDS110 USB-to-UART. The NCP uses the Spinel protocol to communicate to the host. The NCP can be used with the wpantund or border router packages from OpenThread.</p>
<h1><a class="anchor" id="hardware-prereqs"></a> Hardware Prerequisites</h1>
<ul>
<li>2 x CC13X2 / CC26X2 Wireless MCU LaunchPads</li>
<li>1 x Linux computer</li>
</ul>
<h1><a class="anchor" id="software-prereqs"></a> Software Prerequisites</h1>
<ul>
<li>Code Composer Studio (CCS) v10.0 or higher</li>
</ul>
<h1><a class="anchor" id="functional-desc"></a> Functional Description</h1>
<h2><a class="anchor" id="software-overview"></a> Software Overview</h2>
<p>This section describes software components and the corresponding source file.</p>
<h3><a class="anchor" id="application"></a> Application Files</h3>
<ul>
<li><code>main.c</code>: The main entry point for the example. Creates and starts the tasks for operating the OpenThread stack and NCP example.</li>
<li><code>ncp.c</code>: Instantiation of Network Co-Processor object and heartbeat LED loop.</li>
<li><code>otstack.c</code>: OpenThread stack instantiation and processing.</li>
<li><code>task_config.h</code>: Defines RTOS task priorities and call stack sizes.</li>
<li><code>tiop_config.[ch]</code>: Contains OpenThread stack configurations. If using a SysConfig-enabled project (see the Configuration with SysConfig section below), these files are generated and configured through the SysConfig GUI. If using a non-SysConfig project, the files are a part of the project and parameters can be directly modified.</li>
</ul>
<h3><a class="anchor" id="example-application"></a> Example Application</h3>
<p>This application provides an interface for a host system to control the OpenThread networking stack.</p>
<p>A full example of the NCP working with a host processor can be found in the <a href="https://github.com/openthread/borderrouter">Border Router Repository</a>. This will create a border router on the host processor that allows off-mesh commissioning. Information on building the border router can be found on <a href="https://openthread.io/guides/border_router/beaglebone_black">openthread.io</a>.</p>
<p>Another example application to control the NCP can be found in <a href="https://github.com/openthread/wpantund">OpenThread's wpantund repository</a>. This must be built on your Linux host PC before using this NCP example. Information on building wpantund can be found in the <a href="https://github.com/openthread/wpantund">INSTALL.md</a>.</p>
<h1><a class="anchor" id="sysconfig"></a> Configuration With SysConfig</h1>
<p>SysConfig is a GUI configuration tool that allows for TI driver and stack configurations. In order to configure projects using SysConfig, use the SysConfig-enabled version of the Thread examples located in <code>&lt;SDK_ROOT&gt;/examples</code></p>
<p>To configure using SysConfig, import the SysConfig-enabled project into CCS. Double click the <code>*.syscfg</code> file from the CCS project explorer, where <code>*</code> is the name of the example project. The SysConfig GUI window will appear, where Thread stack and TI driver configurations can be adjusted. These settings will be reflected in the generated files <code>tiop_config.[ch]</code>.</p>
<p>The example project comes with working default settings for SysConfig. It is not recommended to change the default driver settings, as any changes may impact the functionality of the example. The Thread stack settings may be changed as required for your use case.</p>
<p>One important note about TI-OpenThread SysConfig is how SysConfig settings and non-volatile storage settings are applied. If the LaunchPad non-volatile holds a valid Thread dataset, SysConfig settings will not be applied on boot. SysConfig settings are only applied when non-volatile storage does not hold a valid Thread dataset. To guarantee SysConfig settings are applied, perform a factory reset of the non-volatile storage, as described below.</p>
<h1><a class="anchor" id="usage"></a> Usage</h1>
<p>This section describes how to set up and run the NCP Example Application. It is assumed that you have installed wpantund on the host Linux machine.</p>
<h2><a class="anchor" id="usage-buttons"></a> Buttons</h2>
<ul>
<li><code>BTN-2</code> at boot: A factory reset of the non-volatile storage is performed. This must be pressed at the start of the <code>OtStack_task</code> function.</li>
</ul>
<h2><a class="anchor" id="usage-display"></a> Display</h2>
<p>There is no display for the NCP example application.</p>
<h2><a class="anchor" id="usage-setup-nwk"></a> Setting up the Thread Network</h2>
<p>This section describes how to set up a Thread network.</p>
<p><em>NOTE</em>: It is assumed that you have also built a CLI example.</p>
<p>On the CLI example; set the channel and panid, then start the OpenThread stack.</p>
<div class="fragment"><div class="line">&gt; channel 14</div><div class="line">Done</div><div class="line">&gt; panid 0xface</div><div class="line">Done</div><div class="line">&gt; ifconfig up</div><div class="line">Done</div><div class="line">&gt; thread start</div><div class="line">Done</div><div class="line">&gt; state</div><div class="line">detached</div><div class="line">&gt; state</div><div class="line">leader</div><div class="line">&gt;</div></div><!-- fragment --><p>The first device has started a Thread network on channel 14 with panid 0xface.</p>
<p><em>NOTE</em>: It is assumed that you have installed wpantund according to the OpenThread instructions.</p>
<p>Your LaunchPad may present its data port on <code>/dev/ttyUSB1</code> instead of <code>/dev/ttyUSB0</code>. This can be set in the configuration file for wpantund.</p>
<p>On your host Linux PC start the wpan tunnel daemon.</p>
<div class="fragment"><div class="line">$ sudo /usr/local/sbin/wpantund -o NCPSocketName /dev/ttyUSB0</div></div><!-- fragment --><p>Open another terminal and start the wpan control application. Then scan for networks and join the OpenThread network started by the CLI example above.</p>
<div class="fragment"><div class="line">$ sudo /usr/local/bin/wpanctl</div><div class="line">wpanctl:wpan0&gt; scan</div><div class="line">   | Joinable | NetworkName        | PAN ID | Ch | XPanID           | HWAddr           | RSSI</div><div class="line">---+----------+--------------------+--------+----+------------------+------------------+------</div><div class="line"> 1 |       NO | &quot;OpenThread&quot;       | 0xFACE | 12 | DEAD00BEEF00CAFE | CA3E7FFCA19D3633 |  -45</div><div class="line">wpanctl:wpan0&gt; join -T r -p 0xface -x dead00beef00cafe -c 12 OpenThread</div><div class="line">Joining &quot;OpenThread&quot; DEAD00BEEF00CAFE as node type &quot;router&quot;</div><div class="line">Successfully Joined!</div><div class="line">wpanctl:wpan0&gt;</div></div><!-- fragment --><p>Open another terminal to ensure that the interface settings have been registered.</p>
<p><em>NOTE</em>: Interfaces other than loopback and wpan elided by the "SNIP".</p>
<div class="fragment"><div class="line">$ ifconfig</div><div class="line"></div><div class="line">----- 8&lt; ----- SNIP ----- 8&lt; -----</div><div class="line"></div><div class="line">lo        Link encap:Local Loopback</div><div class="line">          inet addr:127.0.0.1  Mask:255.0.0.0</div><div class="line">          inet6 addr: ::1/128 Scope:Host</div><div class="line">          UP LOOPBACK RUNNING  MTU:65536  Metric:1</div><div class="line">          RX packets:753 errors:0 dropped:0 overruns:0 frame:0</div><div class="line">          TX packets:753 errors:0 dropped:0 overruns:0 carrier:0</div><div class="line">          collisions:0 txqueuelen:0</div><div class="line">          RX bytes:67805 (67.8 KB)  TX bytes:67805 (67.8 KB)</div><div class="line">wpan0     Link encap:UNSPEC  HWaddr 00-00-00-00-00-00-00-00-00-00-00-00-00-00-00-00</div><div class="line">          inet6 addr: fe80::18d6:da3a:cc8f:1b46/64 Scope:Link</div><div class="line">          UP POINTOPOINT RUNNING NOARP MULTICAST  MTU:1280  Metric:1</div><div class="line">          RX packets:1 errors:0 dropped:0 overruns:0 frame:0</div><div class="line">          TX packets:7 errors:0 dropped:0 overruns:0 carrier:0</div><div class="line">          collisions:0 txqueuelen:500</div><div class="line">          RX bytes:73 (73.0 B)  TX bytes:448 (448.0 B)</div></div><!-- fragment --><h2><a class="anchor" id="usage-control"></a> Pinging between the CLI examples</h2>
<p>Once you have setup the network as above, you can ping between the NCP example and the CLI example nodes. Here we ping the IPv6 all nodes multicast address, and get a response from the CLI's link local address.</p>
<p><em>NOTE</em>: Since we are using link local prefixes, it is necessary to specify the link to send the packet on.</p>
<div class="fragment"><div class="line">$ ping6 -c 4 -I wpan0 ff02::1</div><div class="line">PING fe80:0:0:0:4c7:6d8b:f8cd:9ada(fe80::4c7:6d8b:f8cd:9ada) from fe80::18d6:da3a:cc8f:1b46 wpan0: 56 data bytes</div><div class="line">64 bytes from fe80::4c7:6d8b:f8cd:9ada: icmp_seq=1 ttl=64 time=33.5 ms</div><div class="line">64 bytes from fe80::4c7:6d8b:f8cd:9ada: icmp_seq=2 ttl=64 time=33.7 ms</div><div class="line">64 bytes from fe80::4c7:6d8b:f8cd:9ada: icmp_seq=3 ttl=64 time=34.2 ms</div><div class="line">64 bytes from fe80::4c7:6d8b:f8cd:9ada: icmp_seq=4 ttl=64 time=33.4 ms</div><div class="line">--- fe80:0:0:0:4c7:6d8b:f8cd:9ada ping statistics ---</div><div class="line">4 packets transmitted, 4 received, 0% packet loss, time 3004ms</div><div class="line">rtt min/avg/max/mdev = 33.439/33.756/34.280/0.366 ms</div><div class="line">$</div></div><!-- fragment --> </div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.9.1-->
<!-- start footer part -->
<hr class="footer"/><small>
  <a href="http://www.ti.com/corp/docs/legal/copyright.shtml">&copy; Copyright 1995-2020</a>, Texas Instruments Incorporated. All rights reserved. <br>
  <a href="http://www.ti.com/corp/docs/legal/trademark/trademrk.htm">Trademarks</a> | <a href="http://www.ti.com/corp/docs/legal/privacy.shtml">Privacy policy</a> | <a href="http://www.ti.com/corp/docs/legal/termsofuse.shtml">Terms of use</a> | <a href="http://www.ti.com/lsds/ti/legal/termsofsale.page">Terms of sale</a>
</small>
</body>
</html>
