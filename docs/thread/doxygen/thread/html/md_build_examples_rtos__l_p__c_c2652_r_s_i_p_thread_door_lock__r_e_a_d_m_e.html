<!-- HTML header for doxygen 1.8.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.12"/>
<title>TI-OpenThread: Door Lock Example Application</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link id="favicon" rel="shortcut icon" type="image/x-icon" href="favicon.ico"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="tiapistylesheet.css" rel="stylesheet" type="text/css" />
</head>
<body>
<table width="100%">
<tr>
  <td bgcolor="black" width="1"><a href="http://www.ti.com"><img border="0" src="tilogo.gif" /></a></td>
  <td bgcolor="red"><img src="titagline.gif" /></td>
</tr>
</table>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">TI-OpenThread
   &#160;<span id="projectnumber">1.08.01.12</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.12 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Door Lock Example Application </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>Table of Contents</h2>
<ul>
<li><a href="#sysconfig-notice">SysConfig Notice</a></li>
<li><a href="#intro">Introduction</a></li>
<li><a href="#hardware-prereqs">Hardware Prerequisites</a></li>
<li><a href="#software-prereqs">Software Prerequisites</a></li>
<li><a href="#functional-desc">Functional Description</a><ul>
<li><a href="#software-overview">Software Overview</a><ul>
<li><a href="#application">Application Files</a></li>
<li><a href="#example-application">Example Application</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sysconfig">Configuration With SysConfig</a></li>
<li><a href="#usage">Usage</a><ul>
<li><a href="#usage-buttons">Buttons</a></li>
<li><a href="#usage-display">Display</a></li>
<li><a href="#usage-setup-nwk">Setting up the Thread Network</a></li>
<li><a href="#usage-control">Interfacing with the Example Application</a></li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="intro"></a> Introduction</h1>
<p>This document discusses how to use the Door Lock Example App and the different parts that compose it. Door Lock Example Application is a standalone CoAP server example running on Thread.</p>
<p>Some of the areas explored are:</p>
<ul>
<li>Setting up a network.</li>
<li>Bringing up the device as a Minimum Thread Device (MTD).</li>
<li>Initialization and use of the Constrained Application Protocol (CoAP) APIs.</li>
</ul>
<h1><a class="anchor" id="hardware-prereqs"></a> Hardware Prerequisites</h1>
<ul>
<li>2 x CC13X2 / CC26X2 Wireless MCU LaunchPads</li>
<li>(optional) 1 x Sharp128 LCD boosterpack.</li>
</ul>
<h1><a class="anchor" id="software-prereqs"></a> Software Prerequisites</h1>
<ul>
<li>Code Composer Studio (CCS) v10.0 or higher</li>
</ul>
<h1><a class="anchor" id="functional-desc"></a> Functional Description</h1>
<h2><a class="anchor" id="software-overview"></a> Software Overview</h2>
<p>This section describes software components and the corresponding source file.</p>
<h3><a class="anchor" id="application"></a> Application Files</h3>
<ul>
<li><code>doorlock.[ch]</code>: Contains the application's event loop, CoAP callback functions, and device initialization function calls, and all door lock specific logic.</li>
<li><code>otstack.[ch]</code>: OpenThread stack processing, instantiation and network parameters.</li>
<li><code>task_config.h</code>: This file contains the definitions of the RTOS task priorities and stack sizes.</li>
<li><code>images.[ch]</code>: Contains the raw binary of the images being displayed on the LCD screen.</li>
<li><code>tiop_config.[ch]</code>: Contains OpenThread stack configurations. If using a SysConfig-enabled project (see the Configuration with SysConfig section below), these files are generated and configured through the SysConfig GUI. If using a non-SysConfig project, the files are a part of the project and parameters can be directly modified.</li>
<li><code>tiop_ui.[ch]</code>: Contains functions and defines to enable Thread-specific functionality for the Common User Interface (CUI).</li>
<li><code>tiop_app_defs.h</code>: Contains application-specific configurations for CUI.</li>
</ul>
<h3><a class="anchor" id="example-application"></a> Example Application</h3>
<p>This application provides an example implementation of a door lock using the Thread wireless protocol and CoAP as the application layer protocol. The door lock application is configured as a Minimal Thread Device (MTD) which supports CoAP commands to lock and unlock the door. The door lock can be in two states: lock, and unlock.</p>
<h1><a class="anchor" id="sysconfig"></a> Configuration With SysConfig</h1>
<p>SysConfig is a GUI configuration tool that allows for TI driver and stack configurations. In order to configure projects using SysConfig, use the SysConfig-enabled version of the Thread examples located in <code>&lt;SDK_ROOT&gt;/examples</code></p>
<p>To configure using SysConfig, import the SysConfig-enabled project into CCS. Double click the <code>*.syscfg</code> file from the CCS project explorer, where <code>*</code> is the name of the example project. The SysConfig GUI window will appear, where Thread stack and TI driver configurations can be adjusted. These settings will be reflected in the generated files <code>tiop_config.[ch]</code>.</p>
<p>The example project comes with working default settings for SysConfig. It is not recommended to change the default driver settings, as any changes may impact the functionality of the example. The Thread stack settings may be changed as required for your use case.</p>
<p>One important note about TI-OpenThread SysConfig is how SysConfig settings and non-volatile storage settings are applied. If the LaunchPad non-volatile holds a valid Thread dataset, SysConfig settings will not be applied on boot. SysConfig settings are only applied when non-volatile storage does not hold a valid Thread dataset. To guarantee SysConfig settings are applied, perform a factory reset of the non-volatile storage, as described below.</p>
<h1><a class="anchor" id="usage"></a> Usage</h1>
<p>This section describes how to set up and run the Door Lock Example Application.</p>
<h2><a class="anchor" id="usage-buttons"></a> Buttons</h2>
<ul>
<li><code>BTN-2</code> at boot: A factory reset of the non-volatile storage is performed. This must be pressed at the start of the <code>OtStack_task</code> function.</li>
<li><code>BTN-1</code> at boot: A reset to factory image is performed for OAD capable devices. This must be pressed at the start of the <code>OtStack_task</code> function.</li>
<li><code>BTN-2</code>: Start the joining process. This may be pressed after the hold image appears on-screen.</li>
</ul>
<h2><a class="anchor" id="usage-display"></a> Display</h2>
<p>There are 2 ways that this application will display information to the user which can be used simultaneously and are described below:</p>
<ol type="1">
<li>Serial terminal: The door lock events will be displayed through UART to serial terminal emulator. To enable the serial terminal in CCS press <code>Ctrl<ul>
<li>Shift + Alt + T, select <code>Serial Terminal</code> under <code>Choose terminal</code>, select <code>115200</code> for Baud Rate and click <code>OK</code>. PuTTY may also be used as the serial terminal emulator. The serial interface implements a Common User Interface (CUI). More details are provided in the "Example Applications" section in the Thread docs of the SDK. Application-specific portions of CUI are described <a href="#application-specific-cui">below</a>.</li>
</ul>
</code></li>
<li><code>Sharp128 LCD boosterpack: There is no extra configuration needed to use the LCD boosterpack other than plugging it to the LaunchPad running the example application.</code></li>
</ol>
<p><code></p><h2><a class="anchor" id="usage-setup-nwk"></a> Setting up the Thread Network</h2>
<p></code></p>
<p><code></code></p>
<p><code>This section describes how to set up a Thread network. The application supports the ability to be commissioned into a Thread network. Commissioning may be bypassed by setting the <code>TIOP_CONFIG_SET_NW_ID</code> parameter to 1 in <code>tiop_config.h</code> and setting the network ID parameters there. This can also be done through SysConfig in the TI-OpenThread stack module, under the Network ID submodule. By setting the PAN ID to a valid, non-broadcast ID (not 0xFFFF), the device can be pre-commissioned to an existing network.</code></p>
<p><code></p><ol type="1">
<li>Set up a LaunchPad as a CLI FTD device by following the README files in the respective application folder.</li>
<li>Load and run the DoorLock example on a second LaunchPad.</li>
<li>The Door Lock Launchpad will print out the device's EUI64 and the application's PSKd (pre-shared key device identifier) in CUI, on the Device Info line. If the device has already been commissioned, skip to step 8.</li>
</ol>
<p></code></p>
<p><code></p><div class="fragment"><div class="line">Device Info: [EUI64] 00124b000f6e6113  [PSKD] DRRLCK1</div></div><!-- fragment --><p></code></p>
<p><code></p><ol type="1">
<li>Start a commissioner on the CLI FTD by issuing the following command: <code>commissioner start</code>. It will display <code>Done</code> if it succeeds in becoming the active commissioner.</li>
<li>Add the Door Lock LaunchPad device as a joiner device by providing its EUI64 and pskd (from step 3) as credentials to the commissioner: <code>commissioner joiner add 00124b000f6e6113 DRRLCK1</code>. It will display <code>Done</code> if it is successful in adding the joiner entry.</li>
<li>Now on the Door Lock LaunchPad, press <code>BTN-2</code> to start the joining process. The display will show <code>Joining Nwk ...</code>.</li>
</ol>
<p></code></p>
<p><code></p><div class="fragment"><div class="line">Conn Info: [Status] Joining Nwk ...</div></div><!-- fragment --><p></code></p>
<p><code></p><ol type="1">
<li>Once the joining process has successfully completed, the display will show <code>Nwk Joined</code>. If the LCD is used, it will then switch to the door lock image. The green LED should turn on on the LaunchPad once it has joined the network.</li>
</ol>
<p></code></p>
<p><code></p><div class="fragment"><div class="line">Conn Info: [Status] Nwk Joined</div></div><!-- fragment --><p></code></p>
<p><code></p><ol type="1">
<li>Next we need to get the IPv6 address of the Door Lock LaunchPad. On the CLI, use the command <code>ping ff03::1</code> to send an ICMP echo request to the realm-local all nodes multicast address. All devices on the Thread network will respond with an ICMP echo response. You will see in the terminal a response like the one below.</li>
</ol>
<p></code></p>
<p><code></p><div class="fragment"><div class="line">8 bytes from fd00:db7:0:0:0:ff:fe00:b401: icmp_seq=1 hlim=64 time=11ms</div></div><!-- fragment --><p></code></p>
<p><code></p><h2><a class="anchor" id="usage-control"></a></h2>
<p></code></p>
<p><code> </p><h2>Interfacing with the Door Lock Application</h2>
<p></code></p>
<p><code></code></p>
<p><code>The door lock application hosts a simple CoAP server with one registered resource for the lock state. This resource supports CoAP GET and POST commands. Any device with scope of the door lock's IPv6 address can send commands to the door lock application.</code></p>
<p><code>Door lock Attribute URI:</code></p>
<p><code></p><ul>
<li>Door lock state: <code>doorlock/lockstate</code></li>
</ul>
<p></code></p>
<p><code>Open up the serial terminal to the <code>cli_ftd</code> application and also to the Door lock application.</code></p>
<p><code></p><h3>Starting the CoAP client</h3>
<p></code></p>
<p><code></code></p>
<p><code>In the CLI FTD serial terminal, execute <code>coap start</code> at the prompt to start the CoAP service. It will display the following message if it successful in starting the CoAP service: <code>Coap service started: Done</code> .</code></p>
<p><code></p><h3>Getting status from the Door lock</h3>
<p></code></p>
<p><code></code></p>
<p><code>To get the door lock's lock state, execute the following command on the CLI FTD terminal. </p><div class="fragment"><div class="line">coap get fd00:db7:0:0:0:ff:fe00:b401 /doorlock/lockstate</div></div><!-- fragment --><p></code></p>
<p><code><em>NOTE</em>: The IPv6 address will be different for your setup</code></p>
<p><code>The door lock should respond, and the <code>cli_ftd</code> will print a message like the following.</code></p>
<p><code></p><div class="fragment"><div class="line">Received coap response with payload: 756e6c6f636b</div></div><!-- fragment --><p></code></p>
<p><code>Converting the payload from hex to ascii we get <code>unlock</code>.</code></p>
<p><code></p><h3>Controlling the Door Lock</h3>
<p></code></p>
<p><code></code></p>
<p><code>The door lock state can be changed by sending the appropriate payload in a CoAP confirmable (con) POST command message, to the IPv6 address of the door lock and the resource URI attribute.</code></p>
<p><code>Use the following command in the CLI FTD terminal to set the door lock's lock state to lock.</code></p>
<p><code></p><div class="fragment"><div class="line">coap post fd00:db7:0:0:0:ff:fe00:b401 /doorlock/lockstate con lock</div></div><!-- fragment --><p></code></p>
<p><code><em>NOTE</em>: The IPv6 address will be different for your setup</code></p>
<p><code>The initial command will result in the message <code>Sending coap request: Done</code>. The door lock will respond, and the CLI FTD will print the following message.</code></p>
<p><code></p><div class="fragment"><div class="line">Received coap response with payload: 6c6f636b</div></div><!-- fragment --><p></code></p>
<p><code>If the POST was successful, then the door lock will indicate this on the LCD or UART terminal. If a LCD boosterpack is used, the door lock will change the image displayed. If a UART terminal is used, the door lock will print its updated state.</code></p>
<p><code></p><div class="fragment"><div class="line">APP Info: [Doorlock State] lock</div></div><!-- fragment --><p></code></p>
<p><code>The above process can be repeated with the string <code>unlock</code> in place of <code>lock</code> to set the door lock example to the unlocked state.</code></p>
<p><code></p><h4><a class="anchor" id="application-specific-cui"></a> Application-specific CUI</h4>
<p></code></p>
<p><code></code></p>
<p><code>The application-specific action for the Door Lock example is <code>TOGGLE LOCK</code>.</code></p>
<p><code></p><div class="fragment"><div class="line">TI Thread Doorlock</div><div class="line"></div><div class="line">&lt;  TOGGLE LOCK   &gt;</div></div><!-- fragment --><p> This action will toggle the state of the door lock. For example, if the state of the door lock is "lock", this action will change it to "unlock", and vice versa. To use, hit the "Enter" key. </code></p>
</div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.9.1-->
<!-- start footer part -->
<hr class="footer"/><small>
  <a href="http://www.ti.com/corp/docs/legal/copyright.shtml">&copy; Copyright 1995-2020</a>, Texas Instruments Incorporated. All rights reserved. <br>
  <a href="http://www.ti.com/corp/docs/legal/trademark/trademrk.htm">Trademarks</a> | <a href="http://www.ti.com/corp/docs/legal/privacy.shtml">Privacy policy</a> | <a href="http://www.ti.com/corp/docs/legal/termsofuse.shtml">Terms of use</a> | <a href="http://www.ti.com/lsds/ti/legal/termsofsale.page">Terms of sale</a>
</small>
</body>
</html>
